<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category</title>
    <link rel="stylesheet" href="/assets/admin/category.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    <style>
     .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        /* Style for the pop-up content */
        .popup-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }

        
        /* Style for the close button */
        .close {
            color: #aaa;
            float: right;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

/* Style when hovering over the close button */
        .close:hover {
           color: rgb(97, 0, 0);
        }


        /* Style for the form elements */
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }

        button {
            background-color: #f73904;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .toggle-button{
          height: 36px;
        }

        button:hover {
            background-color: #6e0c01;
        }
        .text-gradient{
            cursor: pointer;
            padding-left: 8px;
            background: linear-gradient(to right,#8e2de2,#4a00e0);
           -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
}
    </style>
</head>
<body>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />  
    

    
   <nav class="sidebar">
      <header>
        <div class="image-text">
          <span class="image">
            <img src="/img/admin.png" alt="logo" />
          </span>
          <div class="text header-text">
            <span class="main">ADMIN</span>
            <br>
            <span class="sub">is now active</span>
          </div>
        </div>
      </header>

      <div class="menu-bar">
        <div class="menu">
          <ul class="menu-links">
            <li class="nav-link">
              <a href="/dash">
                <i class="bx bx-home-alt icons"></i>
                <span class="text nav-text">Dashboard</span>
              </a>
            </li>
            <li class="nav-link">
              <a href="/userAdmin">
                <i class='bx bxs-user-detail icons'></i>
                
                <span class="text nav-text">User Management</span>
              </a>
            </li>
            <li class="nav-link">
              <a href="/productManag">
                <i class='bx bx-cart-add icons'></i>
                <span class="text nav-text">Product Management</span>
              </a>
            </li>
            <li class="nav-link">
              <a href="/orderManage">
                <i class='bx bx-money-withdraw icons'></i>
                <span class="text nav-text">Order & Payments</span>
              </a>
            </li>
            <li class="nav-link">
              <a href="/salesReport">
                <i class='bx bxs-report icons'></i>
                <span class="text nav-text">Sales Report</span>
              </a>
            </li>
            <li class="nav-link">
              <a href="/coupon">
                <i class='bx bxs-coupon icons'></i>
                <span class="text nav-text">coupon</span>
              </a>
            </li>
            <!-- <li class="nav-link">
              <a href="#">
                <i class='bx bxs-sticker icons'></i>
                <span class="text nav-text">Banner</span>
              </a>
            </li> -->
          </ul>
        </div>

        <div class="bottom-content">
          <li class="nav-link">
            <a href="/adminLogin">
              <i class="bx bx-log-out icons"></i>
              <span class="text nav-text">Log Out</span>
            </a>
          </li>
          
          </li>
        </div>
      </div>
    </nav>
    <div class="main-content">
      
     <nav class="navbar" style="position: fixed;width:83.7%;z-index: 1;box-shadow: 2px 4px 8px rgba(0, 0, 0, 0.5);">

          <div class="navbar-left">
              <img src="/img/man-looking-at-computer.jpg" alt="Admin Image" class="admin-image">
              <div class="admin-details">
                  <p class="admin-name">Mohammad Anas AN</p>
                  <p class="admin-role">Administrator</p>
              </div>
          </div>
          <div class="navbar-right">
           
              
              <img src="/img/th.jpeg" alt="Indian Flag" class="indian-flag">
          </div>
          <div class="navCenter">
            <img src="/img/furniture-logo.jpg" alt="Admin Image" class="logo-img">
            <h3>DECORE COMPANY</h3>
          </div>
      </nav>
      
      <section class="user-management">
        
        <button id="addCategoryBtn">Add Category</button>
        
        <div id="addCategoryPopup" class="popup">
          <% if (typeof errorMessage !== 'undefined') { %>
            <p style="color: red; width:300px"><%= errorMessage %></p>
          <% } %>
          <div class="popup-content">
              <span class="close" onclick="closePopup()"><i class="fa fa-times"></i></span>
              <h2>Add Category</h2>
             
              <form id="addCategoryForm">
                  <label for="categoryName">Category Name:</label>
                  <input type="text" id="categoryName" name="categoryName" required>
                  <p id="errorMessage" class="error-message"></p>
                  

                  <button type="button" onclick="addCategory()">Add Category</button>
              </form>
          </div>
      </div>
       
        <ul class="user-list">
            <!-- User 1 -->
            <li class="user-item">
                <span class="column">Id</span>
                <span class="column">Category</span>
                <span class="column">Actions</span>
                <!-- <span class="column"></span> -->
            </li>
            
            <!-- User 2 (Example) -->
            <%categories.forEach((category,index)=>{ %>
            <li class="user-item">
                <span class="column"><%=index+1%></span>
                <span class="column"><%=category.categoryName%></span>
                <!-- <span class="column">
                    <label class="switch">
                        <input type="checkbox">
                        <span class="slider round"></span>
                    </label>
                </span> -->
                <span class="column">
                  <form action="/blockCategory/<%= category._id %>" method="POST">
                    <button type="submit" class="toggle-button visibility <%= category.isBlocked ? 'unblocked-category' : 'blocked-category' %>">
                      <% if (category.isBlocked) { %>
                        Unlist 
                      <% } else { %>
                        List 
                      <% } %>
                    </button>
                  </form>
                  <form method="GET" action="/editCategory/<%=category._id%>" class="block-category-form">
                    <button class="edit-button">Edit</button>
                  </form>
                  <form method="POST" action="/deleteCategory/<%= category._id %>" class="delete-category-form">
                    <button class="delete-button">Delete</button>
                  </form>
                </span>
            </li>
            <%});%>
            <!-- Add more users as needed -->
        </ul>
        
    </section>
      
      <div class="bottom-content">
        <li class="nav-link">
            <a href="/adminLogin">
                <i class="bx bx-log-out icons"></i>
                <span class="text nav-text">Log Out</span>
            </a>
        </li>
    </div>
    
  <!-- ... (existing bottom content code) ... -->
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Get all delete buttons
    const deleteButtons = document.querySelectorAll(".delete-button");

    // Add click event listener to each delete button
    deleteButtons.forEach(function(button) {
        button.addEventListener("click", function(event) {
            event.preventDefault(); // Prevent form submission

            // Get the form associated with the button
            const form = button.closest('.delete-category-form');

            // Show SweetAlert confirmation dialog
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you want to delete this category?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // If user confirms, submit the form
                    form.submit();
                }
            });
        });
    });
});

</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Get all block/unblock buttons
    const blockButtons = document.querySelectorAll(".toggle-button");

    // Add click event listener to each block/unblock button
    blockButtons.forEach(function(button) {
        button.addEventListener("click", function(event) {
            event.preventDefault(); // Prevent form submission

            // Get the form associated with the button
            const form = button.closest('form');
            console.log('Form:', form); // Debugging

            // Show SweetAlert confirmation dialog
            Swal.fire({
                title: 'Are you sure?',
                text: "Do you want to change the category status?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, change it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    // If user confirms, submit the form
                    if (form) {
                        form.submit();
                    } else {
                        console.error('Form not found');
                    }
                }
            });
        });
    });
});


</script>
<script>
  // ... (existing scripts) ...

  function openPopup() {
          document.getElementById('addCategoryPopup').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('addCategoryPopup').style.display = 'none';
        }
        
        const errorMessageElement = document.getElementById('errorMessage');
       
        async function addCategory() {

            const categoryName = document.getElementById('categoryName').value;

            try {
        
        const response = await fetch('/category', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ categoryName}),
        });
        const data = await response.json();

        if (data.error) {
          Swal.fire({
          title: 'Error',
          text: data.error,
          icon: 'error',
        });
        }else {
        // Display success message using SweetAlert
        Swal.fire({
          title: 'Success',
          text: data.success,
          icon: 'success',
        }).then(() => {
          document.getElementById('categoryName').value = '';
          closePopup();
          window.location.reload();
        });
      }
        } catch (error) {
        console.error('Error adding category:', error);
        //  showError('An error occurred while adding the category.');
        Swal.fire({
        title: 'Error',
        text: 'An error occurred while adding the category.',
        icon: 'error',
      });
        }
             
        }
    
        document.getElementById('addCategoryBtn').addEventListener('click', openPopup);


        function openPop(index) {
              document.getElementById('editCategoryPopup' + index).style.display = 'flex';
        }

        function closePop(index) {
               document.getElementById('editCategoryPopup' + index).style.display = 'none';
        }
        
        function editcategory(){
            closePopup();
        }
</script>
    
  </div>
    
</body>
</html>